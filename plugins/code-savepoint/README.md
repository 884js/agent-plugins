# code-savepoint

AIの変更を自動でセーブポイントに保存し、いつでもワンコマンドで戻せるClaude Codeプラグイン。

## 概要

Claude Codeでコード編集中、自動的にセーブポイントを作成します。
変更が気に入らなければ `/code-savepoint:reject` で即座に戻せます。

### 主な機能

- **自動セーブポイント**: セッション開始時・モデル停止時に自動作成
- **ワンコマンドで戻す**: `/code-savepoint:reject` で直前の状態に復元
- **差分確認**: `/code-savepoint:diff` で変更内容を確認
- **履歴管理**: `/code-savepoint:list` で全セーブポイントを一覧表示

### クイックスタート

```bash
# セーブポイント一覧を確認
/code-savepoint:list

# 現在の変更を確認
/code-savepoint:diff

# AIの変更を取り消して直前に戻す
/code-savepoint:reject
```

---

## 詳細

### 仕組み

このプラグインは Claude Code のフック機能を使って動作します：

1. **セッション開始時**: 初期状態をセーブポイントとして保存
2. **モデル停止時**: 変更があれば新しいセーブポイントを作成
3. **セッション終了時**: セーブポイントリポジトリをクリーンアップ

内部では git を使用しており、効率的な差分管理と高速な復元を実現しています。

### スキル一覧

#### `/code-savepoint:list`
セーブポイントの一覧を表示します。

| 表示内容 | 説明 |
|---------|------|
| セーブポイント名 | `sp-YYYYMMDD-HHMMSS` 形式 |
| 日時 | 作成日時 |
| 変更サマリー | 変更されたファイル（最大3つ） |

#### `/code-savepoint:diff [セーブポイント1] [セーブポイント2]`
セーブポイント間の差分を表示します。

- **引数なし**: 最新セーブポイント ↔ 現在の状態
- **1つ**: 指定セーブポイント ↔ 現在の状態
- **2つ**: セーブポイント1 ↔ セーブポイント2

#### `/code-savepoint:reject`
直前のセーブポイントに戻します。AIの変更を即座に取り消したい場合に使用。

#### `/code-savepoint:restore <セーブポイント名>`
指定したセーブポイントに戻します。

```bash
# 例
/code-savepoint:restore sp-20250126-153045
```

### ストレージ

- **保存先**: `~/.claude/savepoint-repos/`
- **リポジトリ名**: `{プロジェクトハッシュ}-{セッションID}`

#### ファイル追跡

| プロジェクト種別 | 追跡対象 |
|-----------------|---------|
| gitプロジェクト | `git ls-files` で管理されているファイル |
| 非gitプロジェクト | 3階層までのファイル（dotfiles, node_modules等は除外） |

### 注意事項

- `.claude/` ディレクトリ内のプロジェクトはセーブポイント対象外
- `restore` / `reject` 実行時、戻り先より新しいセーブポイントは削除されます（線形履歴）
- バイナリファイルの差分は表示されません

---

## ライセンス

MIT
